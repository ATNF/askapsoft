#
# Central Processor Ingest Pipeline Configuration
#

#
#  Scheduling Block Parameters
#
sbid                          = 0

# Array Name
#
array.name = ASKAP

#
# Feed Configurations
#
feeds.names                 = [PAF36]
feeds.n_feeds         = 36
feeds.spacing         = 1deg

feeds.feed0           = [0., 0.]
feeds.feed1           = [0., 0.]
feeds.feed2           = [0., 0.]
feeds.feed3           = [0., 0.]
feeds.feed4           = [0., 0.]
feeds.feed5           = [0., 0.]
feeds.feed6           = [0., 0.]
feeds.feed7           = [0., 0.]
feeds.feed8           = [0., 0.]
feeds.feed9           = [0., 0.]
feeds.feed10          = [0., 0.]
feeds.feed11          = [0., 0.]
feeds.feed12          = [0., 0.]
feeds.feed13          = [0., 0.]
feeds.feed14          = [0., 0.]
feeds.feed15          = [0., 0.]
feeds.feed16          = [0., 0.]
feeds.feed17          = [0., 0.]
feeds.feed18          = [0., 0.]
feeds.feed19          = [0., 0.]
feeds.feed20          = [0., 0.]
feeds.feed21          = [0., 0.]
feeds.feed22          = [0., 0.]
feeds.feed23          = [0., 0.]
feeds.feed24          = [0., 0.]
feeds.feed25          = [0., 0.]
feeds.feed26          = [0., 0.]
feeds.feed27          = [0., 0.]
feeds.feed28          = [0., 0.]
feeds.feed29          = [0., 0.]
feeds.feed30          = [0., 0.]
feeds.feed31          = [0., 0.]
feeds.feed32          = [0., 0.]
feeds.feed33          = [0., 0.]
feeds.feed34          = [0., 0.]
feeds.feed35          = [0., 0.]


#
# Antennas
#

antenna.ant.diameter = 12m
antenna.ant.mount = equatorial
antenna.ant.pointing_parameters = [9 * 0.0]

# ADE antennas - only necessary info
antenna.ant2.location.itrf = [-2556109.976515, 5097388.699862, -2848440.12097248]
antenna.ant2.name = ak02
antenna.ant4.location.itrf = [-2556087.396082, 5097423.589662, -2848396.867933]
antenna.ant4.name = ak04
antenna.ant5.location.itrf =  [-2556028.607336, 5097451.468188, -2848399.83113161]
antenna.ant5.name = ak05
antenna.ant10.location.itrf = [-2556059.228687, 5097560.766055, -2848178.119367]
antenna.ant10.name = ak10
antenna.ant12.location.itrf =   [-2556496.237175, 5097333.724901, -2848187.33832738]
antenna.ant12.name = ak12

# old BETA antennas
antenna.ant1.location.itrf = [-2556084.669, 5097398.337, -2848424.133]
antenna.ant1.name = ak01
antenna.ant15.location.itrf = [-2555389.850372, 5097664.627578, -2848561.95991566]
antenna.ant15.name = ak15
antenna.ant3.location.itrf = [-2556118.109261, 5097384.719695, -2848417.19642608]
antenna.ant3.name = ak03
antenna.ant6.location.itrf = [-2556227.878593, 5097380.442223, -2848323.44598377]
antenna.ant6.name = ak06
antenna.ant8.location.itrf = [-2556002.509816,5097320.293832,-2848637.482106]
antenna.ant8.name = ak08
antenna.ant9.location.itrf = [-2555888.891875,5097552.280516,-2848324.679547]
antenna.ant9.name = ak09

# other to get 12-antennas
antenna.ant7.location.itrf = [-2556282.880670, 5097252.290820, -2848527.104272]
antenna.ant7.name = ak07
antenna.ant11.location.itrf = [-2556397.233607, 5097421.429903, -2848124.497319]
antenna.ant11.name = ak11

# Other to get all 36 antennas
antenna.ant13.location.itrf = [-2556397.233607, 5097421.429903, -2848124.497319]
antenna.ant13.name = ak13
antenna.ant14.location.itrf = [-2556397.233607, 5097421.429903, -2848124.497319]
antenna.ant14.name = ak14
antenna.ant16.location.itrf = [-2556397.233607, 5097421.429903, -2848124.497319]
antenna.ant16.name = ak16
antenna.ant17.location.itrf = [-2556397.233607, 5097421.429903, -2848124.497319]
antenna.ant17.name = ak17
antenna.ant18.location.itrf = [-2556397.233607, 5097421.429903, -2848124.497319]
antenna.ant18.name = ak18
antenna.ant19.location.itrf = [-2556397.233607, 5097421.429903, -2848124.497319]
antenna.ant19.name = ak19

antenna.ant20.location.itrf = [-2556397.233607, 5097421.429903, -2848124.497319]
antenna.ant20.name = ak20
antenna.ant21.location.itrf = [-2556397.233607, 5097421.429903, -2848124.497319]
antenna.ant21.name = ak21
antenna.ant22.location.itrf = [-2556397.233607, 5097421.429903, -2848124.497319]
antenna.ant22.name = ak22
antenna.ant23.location.itrf = [-2556397.233607, 5097421.429903, -2848124.497319]
antenna.ant23.name = ak23
antenna.ant24.location.itrf = [-2556397.233607, 5097421.429903, -2848124.497319]
antenna.ant24.name = ak24
antenna.ant25.location.itrf = [-2556397.233607, 5097421.429903, -2848124.497319]
antenna.ant25.name = ak25
antenna.ant26.location.itrf = [-2556397.233607, 5097421.429903, -2848124.497319]
antenna.ant26.name = ak26
antenna.ant27.location.itrf = [-2556397.233607, 5097421.429903, -2848124.497319]
antenna.ant27.name = ak27
antenna.ant28.location.itrf = [-2556397.233607, 5097421.429903, -2848124.497319]
antenna.ant28.name = ak28
antenna.ant29.location.itrf = [-2556397.233607, 5097421.429903, -2848124.497319]
antenna.ant29.name = ak29

antenna.ant30.location.itrf = [-2556397.233607, 5097421.429903, -2848124.497319]
antenna.ant30.name = ak30
antenna.ant31.location.itrf = [-2556397.233607, 5097421.429903, -2848124.497319]
antenna.ant31.name = ak31
antenna.ant32.location.itrf = [-2556397.233607, 5097421.429903, -2848124.497319]
antenna.ant32.name = ak32
antenna.ant33.location.itrf = [-2556397.233607, 5097421.429903, -2848124.497319]
antenna.ant33.name = ak33
antenna.ant34.location.itrf = [-2556397.233607, 5097421.429903, -2848124.497319]
antenna.ant34.name = ak34
antenna.ant35.location.itrf = [-2556397.233607, 5097421.429903, -2848124.497319]
antenna.ant35.name = ak35
antenna.ant36.location.itrf = [-2556397.233607, 5097421.429903, -2848124.497319]
antenna.ant36.name = ak36

# 4 antennas
antennas = [ant1, ant2, ant3, ant4]
#antennas = [ant2, ant4, ant5, ant12]
# 12 antennas
#antennas = [ant1, ant2, ant3, ant4, ant5, ant6, ant7, ant8, ant9, ant10, ant11, ant12]
# 18 antennas
#antennas = [ant2, ant4, ant5, ant12, ant1, ant3, ant6, ant7, ant8, ant9, ant10, ant11, ant13, ant14, ant15, ant16, ant17, ant18]
#antennas = [ant1, ant2, ant3, ant4, ant5, ant6, ant7, ant8, ant9, ant10, ant11, ant12, ant13, ant14, ant15, ant16, ant17, ant18]
# Maximum number of antennas (36)
#antennas = [ant1, ant2, ant3, ant4, ant5, ant6, ant7, ant8, ant9, ant10, ant11, ant12, ant13, ant14, ant15, ant16, ant17, ant18, ant19, ant20, ant21, ant22, ant23, ant24, ant25, ant26, ant27, ant28, ant29, ant30, ant31, ant32, ant33, ant34, ant35, ant36]
#antennas = [ant2, ant4, ant5, ant12, ant1, ant3, ant6, ant7, ant8, ant9, ant10, ant11, ant13, ant14, ant15, ant16, ant17, ant18, ant19, ant20, ant21, ant22, ant23, ant24, ant25, ant26, ant27, ant28, ant29, ant30, ant31, ant32, ant33, ant34, ant35, ant36]

# Baseline (correlation product) mapping
baselinemap.name = standard

# minimal MS with 4 antennas
baselinemap.antennaidx = [ak01, ak02, ak03, ak04]
#baselinemap.antennaidx = [ak02, ak04, ak05, ak12]
# 12 antennas
#baselinemap.antennaidx = [ak01, ak02, ak03, ak04, ak05, ak06, ak07, ak08, ak09, ak10, ak11, ak12]
# 18 antennas
#baselinemap.antennaidx = [ak01, ak02, ak03, ak04, ak05, ak06, ak07, ak08, ak09, ak10, ak11, ak12, ak13, ak14, ak15, ak16, ak17, ak18]
#baselinemap.antennaidx = [ak02, ak04, ak05, ak12, ak01, ak03, ak06, ak07, ak08, ak09, ak10, ak11, ak13, ak14, ak15, ak16, ak17, ak18]
# Maximum number of antennas (36)
#baselinemap.antennaidx = [ak02, ak04, ak05, ak12, ak01, ak03, ak06, ak07, ak08, ak09, ak10, ak11, ak13, ak14, ak15, ak16, ak17, ak18, ak19, ak20, ak21, ak22, ak23, ak24, ak25, ak26, ak27, ak28, ak29, ak30, ak31, ak32, ak33, ak34, ak35, ak36]

# Antenna indices. Must be in the increasing order
baselinemap.antennaindices = [0, 1, 2, 3]
#baselinemap.antennaindices = [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11]
#baselinemap.antennaindices = [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17]
#baselinemap.antennaindices = [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35]

# Updated channel width with more accuracy.
# The old one is not sufficient for maximum bandwidth of 384MHz
#correlator.mode.standard.chan_width = 18.518518kHz
correlator.mode.standard.chan_width = 18.518518518kHz
correlator.mode.standard.interval = 5000000
correlator.mode.standard.n_chan = 216
correlator.mode.standard.stokes = [XX, XY, YX, YY]
correlator.modes = [standard]


#
# Task List
# Changed outside
tasks.tasklist = [MergedSource, CalcUVWTask, Monitor, MSSink]

# metadata-specific 
metadata_source.ice.locator_host = localhost
metadata_source.ice.locator_port = 4061
metadata_source.icestorm.topicmanager = IceStorm/TopicManager@IceStorm.TopicManager
# next one is in common
metadata.topic = metadata

#
# CalcUVWTask
#
tasks.CalcUVWTask.type                  = CalcUVWTask

# SimpleMonitor
tasks.Monitor.type  = SimpleMonitorTask
tasks.Monitor.params.baselineids = [0,1,2]

tasks.Monitor.params.0 = [0,0,XX]
tasks.Monitor.params.1 = [1,1,XX]
tasks.Monitor.params.2 = [2,2,XX]

tasks.Monitor.params.nbeam = 9

#
# MSSink
#
tasks.MSSink.type                       = MSSink
tasks.MSSink.params.filename            = ingest_test%w.ms
#tasks.MSSink.params.filename            = %d_%t.ms
tasks.MSSink.params.stman.bucketsize    = 131072
tasks.MSSink.params.stman.tilencorr     = 4
tasks.MSSink.params.stman.tilenchan     = 216
tasks.MSSink.params.pointingtable.enable   = true


# 
# Monitoring Data Publisher Configuration
#
monitoring.enabled = false
monitoring.ice.locator_host = localhost
monitoring.ice.locator_port = 4061
monitoring.servicename = MonitoringService
monitoring.adaptername = IngestPipelineMonitoringAdapter

#
# Merge
tasks.Merge.type                     = ChannelMergeTask
tasks.Merge.params.ranks2merge = 2


# Number of channels a given ingest process is meant to receive/process

#
# MergedSource: joining visibilities and metadata
#
tasks.MergedSource.type                             = MergedSource
tasks.MergedSource.params.vis_source.receive_buffer_size = 67108864
tasks.MergedSource.params.vis_source.port           = 3000
tasks.MergedSource.params.vis_source.max_beamid     = 36
tasks.MergedSource.params.vis_source.max_slice      = 0
tasks.MergedSource.params.maxbeams = 36
# Automatically generated channel list
tasks.MergedSource.params.n_channels.0..1 = 216
